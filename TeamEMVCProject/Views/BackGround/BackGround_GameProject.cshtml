@model TeamEMVCProject.Models.LastProductedModel
@{
    Layout = "~/Views/Shared/_BackGroundLayout.cshtml";


    MVCEF.Models.DbHelper db = new MVCEF.Models.DbHelper();
    Array lastproducted = db.LastProductedModule.ToArray();

    Dictionary<int, TeamEMVCProject.Models.LastProductedModel> lastPorducts = new Dictionary<int, TeamEMVCProject.Models.LastProductedModel>();
    int count = 1;
    foreach (TeamEMVCProject.Models.LastProductedModel item in lastproducted)
    {
        lastPorducts.Add(count++, item);
    }
}



<div class="templatemo-content-widget no-padding">
  
    <div class="templatemo-content-widget white-bg">
        <h2 class="margin-bottom-10">作品管理</h2>
        <a class="btn btn-primary" role="button" data-toggle="collapse" href="#collapsePanel" aria-expanded="false" aria-controls="collapsePanel">
            添加新作品
        </a>

        <br />

        <div class="collapse" id="collapsePanel">
            <div class="well">
                @using (Html.BeginForm("AddGameProduct", "BackGround", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true)
                    <fieldset>
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 form-group">
                                <label for="ProdName">作品名称</label>
                                @Html.TextBoxFor(m => m.ProductName, new { @id = "ProdName", @class = "form-control highlight", @placeholder = "请输入作品名称" })
                            </div>
                        </div>

                        <div class="row form-group">
                            <div class="col-lg-12 form-group">
                                <label class="control-label" for="ProdDes">作品简介</label>
                                @Html.TextAreaFor(m => m.ProductDescribe, new { @id = "ProdDes", @class = "form-control", @placeholder = "请输入作品简介",@row=3 })
                            </div>
                        </div>

                        <div enctype="multipart/form-data">
                            <input id="file-0a" class="file" name="pic" type="file" multiple data-min-file-count="1">
                        </div>

                        <div class="form-group text-right">
                            <button type="submit" class="templatemo-blue-button">添加作品信息</button>
                            <button type="reset" class="templatemo-white-button">重置</button>
                        </div>
                    </fieldset>
                }
</div>
        </div>

        <div class="panel panel-default table-responsive">
            <table class="table table-striped table-bordered templatemo-user-table">
                <thead>
                    <tr>
                        <td><a href="" class="white-text templatemo-sort-by">#<span class="caret"></span></a></td>
                        <td><a href="" class="white-text templatemo-sort-by">作品Id<span class="caret"></span></a></td>
                        <td><a href="" class="white-text templatemo-sort-by">作品名称<span class="caret"></span></a></td>
                        <td><a href="" class="white-text templatemo-sort-by">作品发布时间<span class="caret"></span></a></td>
                        <td><a href="" class="white-text templatemo-sort-by">作品简介<span class="caret"></span></a></td>
                        <td><a href="" class="white-text templatemo-sort-by">作品图片地址<span class="caret"></span></a></td>
                        <td>编辑作品信息</td>
                        <td>删除作品</td>
                    </tr>
                </thead>
                <tbody>
                    @{
                        foreach (var u in lastPorducts)
                        {
                            <tr>
                                <td>@u.Key</td>
                                <td>@u.Value.id</td>
                                <td>@u.Value.ProductName</td>
                                <td>@u.Value.ProductPublishTime.ToShortDateString()</td>
                                <td>@u.Value.ProductDescribe</td>
                                <td>@u.Value.ProductImgSrc</td>
                                <td><a class="templatemo-edit-btn btn" data-toggle="modal" data-target="#ProductEdit" data-proid=@u.Value.id data-proname=@u.Value.ProductName data-propublish=@u.Value.ProductPublishTime data-prodes=@u.Value.ProductDescribe data-proimgsrc=@u.Value.ProductImgSrc>编辑</a></td>
                                <td><a class="templatemo-edit-btn btn" data-toggle="modal" data-target="#Warning" data-warninfo=@u.Value.id>删除</a></td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


@Html.Partial("~/Views/BackGround/Partials/BackGround_Component_LastedProductedEdit.cshtml");


        <!-- JS -->
        <script type="text/javascript" src="~/assets/js/jquery-2.1.3.min.js"></script>    <!-- jQuery -->
        <script type="text/javascript" src="~/assets/js/templatemo-script.js"></script>      
        <script>

            jQuery('#ProductEdit').on('show.bs.modal', function (event) {

                // 触发弹出层的物体
                var button = jQuery(event.relatedTarget);
                //获取作品信息
                var proid = button.data('proid');
                //var proname = button.data('proname');
                //var prodes = button.data('prodes');
                //var prosrc = button.data('prosrc');

                var modal = jQuery(this);

                if (proid) {
                    modal.find('.modal-title').text("ID:" + proid);

                    modal.find("#proid").val(proid);
                    modal.find("#proid").attr("readonly", "readonly");
                }
                else
                    modal.find('.modal-title').text("ID:None");

            })

            jQuery('#Warning').on('show.bs.modal', function (event) {

                // 触发弹出层的物体
                var button = jQuery(event.relatedTarget);
                //获取删除用户信息
                var warninfo = button.data('warninfo');

                var modal = jQuery(this);

                if (warninfo) {
                    modal.find("#WarningInfo").val(warninfo);
                    modal.find("#WarningInfo").attr("name", "deleteId");
                }
            })
        </script>
