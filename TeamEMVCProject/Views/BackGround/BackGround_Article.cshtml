@using TeamEMVCProject.Models
@using TeamEWebSite.App_Code
@model TeamEMVCProject.Models.ArticleShare
@{
    ViewBag.Title = "BackGround_Article";
    Layout = "~/Views/Shared/_BackGroundLayout.cshtml";
    
    
    var db = new DbHelper();
    //技术文章信息
    Array articleInfo = db.ArticleShareModule.ToArray();

    var count = 1;
    var articleInfoDic = articleInfo.Cast<ArticleShare>().ToDictionary(item => count++);

    
}


<link href="~/assets/css/bootstrap-markdown.min.css" rel="stylesheet">

<div class="htmleaf-container">
    <div class="container mp30">

        @*轮播*@

        <div class="row">
            @Html.Partial("~/Views/Partials/Carousel.cshtml")
        </div>

        <br />
        <br />

        @*文章发布以及文章列表*@
        <div class="row">
            @using (Html.BeginForm("MarkDownArticlePublish", "BackGround", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)
                @*markdown编辑器*@
                <fieldset>
                    <div class="col-md-8">
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 form-group">
                                <label for="a_title">文章名称</label>
                                @Html.TextBoxFor(m => m.ArticleName, new { @id = "a_title", @name = "title", @type = "text", @placeholder = "文章标题？" })
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-lg-6 col-md-6 form-group">
                                <label for="a_des">文章简介</label>
                                @Html.TextBoxFor(m => m.ArticleDescribe, new { @id = "a_des", @name = "des", @type = "text", @placeholder = "文章简介？" })
                            </div>
                        </div>

                        <textarea id="articleEditor" name="content" data-provide="markdown" rows="10"></textarea>

                        <hr />

                        <button id="btn_sub" type="submit" class="btn">发布文章</button>

                        @Html.TextBoxFor(m => m.ArticleInfo, new { @id = "hid", @style = "visibility:hidden" })
                    </div>


                    @*新闻滚动列表*@
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <span class="glyphicon glyphicon-list-alt"></span><b>文章列表</b>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <ul id="newsList">
                                            @foreach (ArticleShare item in articleInfo)
                                            {
                                                item.ArticleImgSrc = "../" + item.ArticleImgSrc;
                                                string hrefSrc = "BackGround_ArticleDetail?Article=" + item.id;
                                                <li class="news-item">
                                                    <table cellpadding="4">
                                                        <tr>
                                                            <td><img src=@item.ArticleImgSrc width="60" class="img-circle" /></td>
                                                            <td>@item.ArticleDescribe<a href=@hrefSrc>查看...</a></td>
                                                        </tr>
                                                    </table>
                                                </li>
                                            }

                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            }
        </div>

        @*文章管理*@
        <div class="row">
            <div class="templatemo-content-widget no-padding">
                <div class="templatemo-content-widget no-padding">

                    <div class="templatemo-content-widget white-bg">
                        <h2 class="margin-bottom-10">文章管理</h2>


                        <div class="panel panel-default table-responsive">
                            <table class="table table-striped table-bordered templatemo-user-table">
                                <thead>
                                    <tr>
                                        <td><a href="" class="white-text templatemo-sort-by">#<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章Id<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章名称<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章发布时间<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章简介<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章图片地址<span class="caret"></span></a></td>
                                        <td><a href="" class="white-text templatemo-sort-by">文章主要内容<span class="caret"></span></a></td>
                                        <td>编辑文章信息</td>
                                        <td>删除文章</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        foreach (var u in articleInfoDic)
                                        {
                                            <tr>
                                                <td>@u.Key</td>
                                                <td>@u.Value.id</td>
                                                <td>@u.Value.ArticleName</td>
                                                <td>@u.Value.ArticlePublishTime.ToShortDateString()</td>
                                                <td>@u.Value.ArticleDescribe</td>
                                                <td>@u.Value.ArticleImgSrc</td>
                                                <td><a class="templatemo-edit-btn btn" data-toggle="modal" data-target="#ArticleInfoEdit" data-artinfo=@u.Value.ArticleInfo>打开文章内容编辑器</a></td>
                                                <td><a class="templatemo-edit-btn btn" data-toggle="modal" data-target="#ArticleEdit" data-proid=@u.Value.id data-artname=@u.Value.ArticleName data-artpublish=@u.Value.ArticlePublishTime data-artdes=@u.Value.ArticleDescribe data-artimgsrc=@u.Value.ArticleImgSrc data-artinfo=@u.Value.ArticleInfo>编辑</a></td>
                                                <td><a class="templatemo-edit-btn btn" data-toggle="modal" data-target="#Warning" data-warninfo=@u.Value.id>删除</a></td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>



                </div>
            </div>

        </div>

    </div>
</div>

<script src="../assets/js/bootstrap-markdown.js"></script>
<script src="../assets/js/to-markdown.js"></script>
<script src="../assets/js/markdown.js"></script>
<script>
    
    markDownArticle();


    ///////////////////////////////
    // 文章编辑器
    ///////////////////////////////

    function markDownArticle() {
        $("#articleEditor").markdown({

            onChange: function (e) {
                $("#hid").val(e.parseContent());
            }
        });
    }
</script>